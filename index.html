<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mailto Link Generator — Protect The Pack</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;max-width:860px;margin:32px auto;padding:0 16px;line-height:1.5}
  h1{margin:0 0 16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{font-weight:600;margin-top:12px;display:block}
  textarea,input{width:100%;box-sizing:border-box;padding:10px;border:1px solid #ddd;border-radius:8px}
  small{color:#666}
  .btns{margin:16px 0;display:flex;gap:12px;flex-wrap:wrap}
  button{padding:10px 14px;border:1px solid #111;border-radius:8px;background:#111;color:#fff;cursor:pointer}
  #output{word-break:break-all;background:#fafafa;border:1px dashed #ccc;padding:10px;border-radius:8px;margin-top:8px}
  code{background:#f5f5f5;padding:2px 6px;border-radius:4px}
</style>
</head>
<body>
<h1>Mailto Link Generator</h1>
<p>Build robust <code>mailto:</code> links for campaigns (subject/body/CC/BCC). Use <code>\n</code> for new lines.</p>

<div class="row">
  <div>
    <label>To (comma-separated)</label>
    <input id="to" placeholder="da@example.gov, animalservices@city.gov">
  </div>
  <div>
    <label>CC (optional)</label>
    <input id="cc" placeholder="publicinfo@city.gov">
  </div>
</div>

<div class="row">
  <div>
    <label>BCC (optional)</label>
    <input id="bcc" placeholder="media@news.com">
  </div>
  <div>
    <label>Subject</label>
    <input id="subject" placeholder="Request: Animal Welfare Check — 2400 Fort Worth Ave">
  </div>
</div>

<label>Body</label>
<textarea id="body" rows="10" placeholder="Dear [TITLE] [LASTNAME],\n\nI am requesting an immediate welfare check at [ADDRESS]...\n\nSincerely,\n[YOUR NAME]\n[POSTCODE]"></textarea>
<small>Tip: On most clients <code>\n</code> becomes a new line. Avoid very long lines; add breaks.</small>

<div class="btns">
  <button id="build">Build mailto</button>
  <button id="test">Open in your client (test)</button>
  <button id="copy">Copy link</button>
</div>

<label>Result</label>
<div id="output"></div>

<hr>
<h2>Optional: Shorten your link</h2>
<p>Paste the full mailto (or any URL) and your GitHub token. This creates a short redirect file in <strong>protectthepack/s</strong>.</p>
<input id="shortlink-input" placeholder="mailto:..." style="width:100%;padding:8px">
<input id="token" type="password" placeholder="GitHub personal access token (repo scope)" style="width:100%;padding:8px;margin-top:6px">
<button id="shorten-btn" style="padding:10px 14px;margin-top:8px;">Create Short Link</button>
<div id="shorten-out" style="margin-top:10px;word-break:break-all"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ========= Mailto builder ========= */
  function enc(v){ return encodeURIComponent(v).replace(/%20/g,'+'); }
  function buildLink(){
    const to = document.getElementById('to').value.trim();
    const cc = document.getElementById('cc').value.trim();
    const bcc= document.getElementById('bcc').value.trim();
    const subject = document.getElementById('subject').value;
    const body = document.getElementById('body').value;
    const params = [];
    if (subject) params.push('subject='+enc(subject));
    if (body)    params.push('body='+enc(body));
    if (cc)      params.push('cc='+enc(cc));
    if (bcc)     params.push('bcc='+enc(bcc));
    const q = params.length ? '?' + params.join('&') : '';
    return 'mailto:' + to + q;
  }

  document.getElementById('build').addEventListener('click', () => {
    document.getElementById('output').textContent = buildLink();
  });

  document.getElementById('copy').addEventListener('click', async () => {
    const link = buildLink();
    try { await navigator.clipboard.writeText(link); alert('Copied!'); }
    catch { alert('Copy failed'); }
  });

  document.getElementById('test').addEventListener('click', () => {
    window.location.href = buildLink();
  });

  /* ========= Shortener (GitHub API) ========= */
  const ghOwner = "protectthepack";
  const ghRepo  = "s";
  const ghToken = "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";

  async function createRedirectFile(code, target, token){
    const safeTargetJs = String(target).replace(/'/g, "\\'");
    const html =
      '<!doctype html>' +
      '<meta http-equiv="refresh" content="0;url=' + target + '">' +
      '<script>location=\'' + safeTargetJs + '\'</scr' + 'ipt>';

    const b64 = btoa(unescape(encodeURIComponent(html)));

    const res = await fetch(`https://api.github.com/repos/${ghOwner}/${ghRepo}/contents/${code}.html`, {
      method: "PUT",
      headers: {
        Authorization: "token " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "Add shortlink " + code,
        content: b64
      })
    });
    if (!res.ok) throw new Error("GitHub API error: " + res.status);
  }

  document.getElementById('shorten-btn').addEventListener('click', async () => {
    const longurl = document.getElementById('shortlink-input').value.trim();
    const token   = document.getElementById('token').value.trim();
    if (!longurl || !token) return alert('Paste both link and token first.');

    const code = Math.random().toString(36).slice(2, 6);
    try {
      await createRedirectFile(code, longurl, ghToken);
      const short = `https://${ghOwner}.github.io/${ghRepo}/${code}.html`;
      document.getElementById('shorten-out').innerHTML =
        `<p><strong>Short link created:</strong> <a href="${short}" target="_blank" rel="noopener">${short}</a></p>`;
    } catch (e) {
      document.getElementById('shorten-out').textContent = e.message;
    }
  });
});
</script>
</body>
</html>
